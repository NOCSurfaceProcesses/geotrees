%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=2,mathnumfig,mathnumsep={.}]{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\addto\captionsenglish{\renewcommand{\contentsname}{Contents:}}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}


\title{GeoTrees}
\date{Jun 03, 2025}
\release{1.0.0\sphinxhyphen{}rc.1}
\author{NOC Surface Processes}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxstepscope


\chapter{Introduction}
\label{\detokenize{introduction:introduction}}\label{\detokenize{introduction::doc}}

\section{geotrees}
\label{\detokenize{introduction:geotrees}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{geotrees}} is a \sphinxhref{https://www.python.org/download/releases/3.0}{python3} library developed at \sphinxhref{https://noc.ac.uk}{NOC} (National Oceanography Centre, Southampton, UK) for
identifying neighbours in a geo\sphinxhyphen{}spatial context. This is designed to solve problems where one needs to identify
data within a spatial range on the surface of the Earth. The library provides implementations of standard tools
for neighbourhood searching, such as \sphinxhref{https://en.wikipedia.org/wiki/K-d\_tree}{k\sphinxhyphen{}d\sphinxhyphen{}tree} and \sphinxhref{https://en.wikipedia.org/wiki/Quadtree}{Quadtree} that have been adapted to account for spherical
geometry, using a \sphinxhref{https://en.wikipedia.org/wiki/Haversine\_formula}{haversine} distance metric.

\sphinxAtStartPar
The tool allows for spatial look\sphinxhyphen{}ups with \(O(\log(n))\) complexity in time. Additionally, a simple 1\sphinxhyphen{}d nearest
neighbours look\sphinxhyphen{}up is provided for sorted data using \sphinxhref{https://en.wikipedia.org/wiki/Bisection\_method}{bisection} search.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{geotrees}} also provides functionality for working with \sphinxhref{https://en.wikipedia.org/wiki/Great\_circle}{great\sphinxhyphen{}circle} objects, for example intersecting
great\sphinxhyphen{}circles.


\section{Credits}
\label{\detokenize{introduction:credits}}

\subsection{Development Lead}
\label{\detokenize{introduction:development-lead}}\begin{itemize}
\item {}
\sphinxAtStartPar
Joseph T. Siddons \textless{}\sphinxhref{mailto:josidd@noc.ac.uk}{josidd@noc.ac.uk}\textgreater{} \sphinxhref{git.noc.ac.uk/josidd}{@josidd}

\end{itemize}


\subsection{Contributoring Developers}
\label{\detokenize{introduction:contributoring-developers}}\begin{itemize}
\item {}
\sphinxAtStartPar
Richard C. Cornes \textless{}\sphinxhref{mailto:rcornes@noc.ac.uk}{rcornes@noc.ac.uk}\textgreater{} \sphinxhref{git.noc.ac.uk/ricorne}{@ricorne}

\end{itemize}

\sphinxstepscope


\chapter{Installation}
\label{\detokenize{installation:installation}}\label{\detokenize{installation::doc}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{geotrees}} is not currently available on PyPI so must be installed either from source or directly from the
GitLab repository. Versions of python between 3.9 and 3.13, inclusive, are supported, however the recommended version of
python is 3.12.

\sphinxAtStartPar
We recommend the installation of \sphinxcode{\sphinxupquote{geotrees}} using the \sphinxhref{https://docs.astral.sh/uv}{uv} package manager, however it can be installed using
\sphinxhref{https://pypi.org}{pip}.

\sphinxAtStartPar
The only required dependency of the project is \sphinxhref{https://numpy.org/}{NumPy}. Additional dependency \sphinxhref{https://pola.rs/}{polars} is required to run the \sphinxhref{https://jupyter.org/}{Jupyter}
notebooks.


\section{Via UV}
\label{\detokenize{installation:via-uv}}
\sphinxAtStartPar
You can install the library directly from the GitLab repository, adding the library to your current uv virtual
environment. This will add the library as a dependency in your current project.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
uv\PYG{+w}{ }add\PYG{+w}{ }git+ssh://git@git.noc.ac.uk/nocsurfaceprocesses/geotrees.git
\end{sphinxVerbatim}


\subsection{Development mode}
\label{\detokenize{installation:development-mode}}
\sphinxAtStartPar
If you wish to contribute to \sphinxcode{\sphinxupquote{geotrees}} you can install the library in development mode. This will require
cloning the repository and creating a new uv environment.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Get the code}
git\PYG{+w}{ }clone\PYG{+w}{ }git@git.noc.ac.uk/nocsurfaceprocesses/geotrees.git
\PYG{n+nb}{cd}\PYG{+w}{ }geotrees

\PYG{c+c1}{\PYGZsh{} Install with all dependencies and create an environment with python 3.12}
uv\PYG{+w}{ }sync\PYG{+w}{ }\PYGZhy{}\PYGZhy{}all\PYGZhy{}extras\PYG{+w}{ }\PYGZhy{}\PYGZhy{}dev\PYG{+w}{ }\PYGZhy{}\PYGZhy{}python\PYG{+w}{ }\PYG{l+m}{3}.12

\PYG{c+c1}{\PYGZsh{} Load the environment}
\PYG{n+nb}{source}\PYG{+w}{ }.venv/bin/activate

\PYG{c+c1}{\PYGZsh{} Run the unit tests}
uv\PYG{+w}{ }run\PYG{+w}{ }pytest\PYG{+w}{ }\PYG{n+nb}{test}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The recommended python version is python 3.12. By default, uv creates a virtual environment in \sphinxcode{\sphinxupquote{.venv}}.
\end{sphinxadmonition}


\section{Via Pip}
\label{\detokenize{installation:via-pip}}
\sphinxAtStartPar
The library can be installed via pip with the following command:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
pip\PYG{+w}{ }install\PYG{+w}{ }git+ssh://git@git.noc.ac.uk/nocsurfaceprocesses/geotrees.git
\end{sphinxVerbatim}


\subsection{From Source}
\label{\detokenize{installation:from-source}}
\sphinxAtStartPar
Alternatively, you can clone the repository and install using pip (or conda if preferred). This installs in \sphinxcode{\sphinxupquote{editable}}
mode.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
git\PYG{+w}{ }clone\PYG{+w}{ }git@git.noc.ac.uk/nocsurfaceprocesses/geotrees.git
\PYG{n+nb}{cd}\PYG{+w}{ }geotrees
python\PYG{+w}{ }\PYGZhy{}m\PYG{+w}{ }venv\PYG{+w}{ }venv
\PYG{n+nb}{source}\PYG{+w}{ }venv/bin/activate
pip\PYG{+w}{ }install\PYG{+w}{ }\PYGZhy{}e\PYG{+w}{ }.
\end{sphinxVerbatim}

\sphinxstepscope


\chapter{Bisection Search}
\label{\detokenize{bisection:bisection-search}}\label{\detokenize{bisection::doc}}
\sphinxAtStartPar
Bisection can be used to find the nearest neighbour in a sorted one\sphinxhyphen{}dimensional list of search values in
\(O(\log(n))\) time complexity.

\sphinxAtStartPar
The implementation in \sphinxtitleref{geotrees} makes use of the \sphinxtitleref{bisect} library, which is part of the Python standard library.
The input types are numeric types, which can include \sphinxcode{\sphinxupquote{int}}, \sphinxcode{\sphinxupquote{float}}, or \sphinxcode{\sphinxupquote{datetime.datetime}} values.

\sphinxAtStartPar
The bisection approach repeatedly splits the list of search values in two at the mid\sphinxhyphen{}index. The query value is compared
to the search value at the mid\sphinxhyphen{}index. If the query value is larger than the search value at the mid\sphinxhyphen{}index, then the
search values after the mid\sphinxhyphen{}index become the new search values. If the query value is smaller than the search value at
the mid\sphinxhyphen{}index then the search values before the mid\sphinxhyphen{}index become the new search values. This bisecting is repeated
(succesively halving the number of search values) until one values remain. The nearest neighbour is either the value at
the remaining index, or the value at the index one above.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The above assumes that the list of search values is sorted in increasing order. The opposite applies if the
list is sorted in reverse.
\end{sphinxadmonition}

\begin{sphinxadmonition}{warning}{Warning:}
\sphinxAtStartPar
The input values must be sorted
\end{sphinxadmonition}


\section{Example}
\label{\detokenize{bisection:example}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{geotrees}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{find\PYGZus{}nearest}
\PYG{k+kn}{import}\PYG{+w}{ }\PYG{n+nn}{numpy}\PYG{+w}{ }\PYG{k}{as}\PYG{+w}{ }\PYG{n+nn}{np}

\PYG{n}{search\PYGZus{}values}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n+nb}{float}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{random}\PYG{o}{.}\PYG{n}{randn}\PYG{p}{(}\PYG{l+m+mi}{50}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{search\PYGZus{}values}\PYG{o}{.}\PYG{n}{sort}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{query\PYGZus{}value}\PYG{p}{:} \PYG{n+nb}{float} \PYG{o}{=} \PYG{l+m+mf}{0.45}
\PYG{n}{neighbour\PYGZus{}index}\PYG{p}{:} \PYG{n+nb}{int} \PYG{o}{=} \PYG{n}{find\PYGZus{}nearest}\PYG{p}{(}
     \PYG{n}{vals}\PYG{o}{=}\PYG{n}{search\PYGZus{}values}\PYG{p}{,}
     \PYG{n}{test}\PYG{o}{=}\PYG{n}{query\PYGZus{}value}\PYG{p}{,}
\PYG{p}{)}
\PYG{n}{neighbour\PYGZus{}value}\PYG{p}{:} \PYG{n+nb}{float} \PYG{o}{=} \PYG{n}{search\PYGZus{}values}\PYG{p}{[}\PYG{n}{neighbour\PYGZus{}index}\PYG{p}{]}
\end{sphinxVerbatim}


\section{neighbours Module}
\label{\detokenize{bisection:module-geotrees.neighbours}}\label{\detokenize{bisection:neighbours-module}}\index{module@\spxentry{module}!geotrees.neighbours@\spxentry{geotrees.neighbours}}\index{geotrees.neighbours@\spxentry{geotrees.neighbours}!module@\spxentry{module}}
\sphinxAtStartPar
Functions for finding nearest neighbours using bisection. Nearest neighbours can
be found with \(O(\log(n))\) time\sphinxhyphen{}complexity.

\sphinxAtStartPar
Data for these functions must be sorted, otherwise incorrect values may be
returned.
\index{SortedError@\spxentry{SortedError}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{bisection:geotrees.neighbours.SortedError}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{exception}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.neighbours.}}\sphinxbfcode{\sphinxupquote{SortedError}}}
\pysigstopsignatures
\sphinxAtStartPar
Error class for Sortedness

\end{fulllineitems}

\index{SortedWarning@\spxentry{SortedWarning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{bisection:geotrees.neighbours.SortedWarning}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{exception}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.neighbours.}}\sphinxbfcode{\sphinxupquote{SortedWarning}}}
\pysigstopsignatures
\sphinxAtStartPar
Warning class for Sortedness

\end{fulllineitems}

\index{find\_nearest() (in module geotrees.neighbours)@\spxentry{find\_nearest()}\spxextra{in module geotrees.neighbours}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{bisection:geotrees.neighbours.find_nearest}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.neighbours.}}\sphinxbfcode{\sphinxupquote{find\_nearest}}}
{\sphinxparam{\DUrole{n}{vals}}\sphinxparamcomma \sphinxparam{\DUrole{n}{test}}\sphinxparamcomma \sphinxparam{\DUrole{n}{check\_sorted}\DUrole{o}{=}\DUrole{default_value}{True}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Find the nearest value in a list of values for each test value.

\sphinxAtStartPar
Uses bisection for speediness!

\sphinxAtStartPar
Returns a list containing the index of the nearest neighbour in vals for
each value in test. Or the index of the nearest neighbour if test is a
single value.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{vals}} (\sphinxstyleliteralemphasis{\sphinxupquote{list}}\sphinxstyleliteralemphasis{\sphinxupquote{{[}}}\sphinxstyleliteralemphasis{\sphinxupquote{Numeric}}\sphinxstyleliteralemphasis{\sphinxupquote{{]}}}) \textendash{} List of values \sphinxhyphen{} this is the pool of values for which we are looking
for a nearest match. This list MUST be sorted. Sortedness is not
checked, nor is the list sorted.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{test}} (\sphinxstyleliteralemphasis{\sphinxupquote{Numeric}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{list}}\sphinxstyleliteralemphasis{\sphinxupquote{{[}}}\sphinxstyleliteralemphasis{\sphinxupquote{Numeric}}\sphinxstyleliteralemphasis{\sphinxupquote{{]}}}) \textendash{} Query value(s)

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{check\_sorted}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Optionally check that the input vals is sorted. Raises an error if set
to True (default), displays a warning if set to False.

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
Index, or list of indices, of nearest value, or values.

\sphinxlineitem{Return type}
\sphinxAtStartPar
int | list{[}int{]}

\end{description}\end{quote}

\end{fulllineitems}


\sphinxstepscope


\chapter{Record Classes}
\label{\detokenize{record:record-classes}}\label{\detokenize{record::doc}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Record}} classes in \sphinxcode{\sphinxupquote{geotrees}} form the back\sphinxhyphen{}bone of the data structures within the library. They represent a
consistent input data\sphinxhyphen{}type across all classes in the library.

\sphinxAtStartPar
There are two classes of \sphinxcode{\sphinxupquote{Record}}:
\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{geotrees.record.Record}} for two\sphinxhyphen{}dimensional data structures defined by \sphinxcode{\sphinxupquote{lon}} (longitude) and \sphinxcode{\sphinxupquote{lat}}
(latitude). Optionally, one can pass \sphinxcode{\sphinxupquote{datetime}} and \sphinxcode{\sphinxupquote{uid}}, as well as additional data attributes with keyword
arguments.

\item {}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{geotrees.record.SpaceTimeRecord}} for three\sphinxhyphen{}dimensional data structures defined by \sphinxcode{\sphinxupquote{lon}} (longitude),
\sphinxcode{\sphinxupquote{lat}} (latitude), and \sphinxcode{\sphinxupquote{datetime}}. Optionally, one can pass \sphinxcode{\sphinxupquote{uid}}, as well as additional data attributes with
keyword arguments.

\end{itemize}

\sphinxAtStartPar
Only the positional, datetime, and uid attributes are used for equality tests. \sphinxcode{\sphinxupquote{Record}} objects are used for
\sphinxcode{\sphinxupquote{QuadTree}} and \sphinxcode{\sphinxupquote{KDTree}} objects, whereas \sphinxcode{\sphinxupquote{SpaceTimeRecord}} objects must be used for \sphinxcode{\sphinxupquote{OctTree}}.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Record}} and \sphinxcode{\sphinxupquote{SpaceTimeRecord}} are exposed at the \sphinxcode{\sphinxupquote{geotrees}} level.
\end{sphinxadmonition}


\section{Example}
\label{\detokenize{record:example}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{geotrees}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{Record}

\PYG{n}{record}\PYG{p}{:} \PYG{n}{Record} \PYG{o}{=} \PYG{n}{Record}\PYG{p}{(}\PYG{n}{lon}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{151.2}\PYG{p}{,} \PYG{n}{lat}\PYG{o}{=}\PYG{l+m+mf}{42.7}\PYG{p}{,} \PYG{n}{uid}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{foo}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{n}{dist}\PYG{p}{:} \PYG{n+nb}{float} \PYG{o}{=} \PYG{n}{record}\PYG{o}{.}\PYG{n}{distance}\PYG{p}{(}\PYG{n}{Record}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{71.1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{23.2}\PYG{p}{,} \PYG{n}{uid}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{bar}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}


\section{record Module}
\label{\detokenize{record:module-geotrees.record}}\label{\detokenize{record:record-module}}\index{module@\spxentry{module}!geotrees.record@\spxentry{geotrees.record}}\index{geotrees.record@\spxentry{geotrees.record}!module@\spxentry{module}}
\sphinxAtStartPar
Record objects used for containing data passed to QuadTree, OctTree and KDTree
classes. Require positions defined by “lon” and “lat”, SpaceTimeRecord objects
also require “datetime”. Optional fields are “uid”, other data can be passed as
keyword arguments. Only positional, temporal, and uid values are used for
equality checks.

\sphinxAtStartPar
Distances between records is calculated using Haversine distance.

\sphinxAtStartPar
Classes prefixed by “SpaceTime” include a temporal dimension and should be used
with OctTree classes.
\index{Record (class in geotrees.record)@\spxentry{Record}\spxextra{class in geotrees.record}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{record:geotrees.record.Record}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.record.}}\sphinxbfcode{\sphinxupquote{Record}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}\sphinxparamcomma \sphinxparam{\DUrole{n}{datetime}\DUrole{o}{=}\DUrole{default_value}{None}}\sphinxparamcomma \sphinxparam{\DUrole{n}{uid}\DUrole{o}{=}\DUrole{default_value}{None}}\sphinxparamcomma \sphinxparam{\DUrole{n}{fix\_lon}\DUrole{o}{=}\DUrole{default_value}{True}}\sphinxparamcomma \sphinxparam{\DUrole{o}{**}\DUrole{n}{data}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A simple instance of a record, it requires position data. It can optionally
include datetime, a UID, and extra data passed as keyword arguments.

\sphinxAtStartPar
Equality is first checked on uid values, if both Records have a uid value
then the Records are equal if the uids are equal. Otherwise records are
compared by checking only on the required fields \& uid if it is specified.

\sphinxAtStartPar
By default, longitudes are converted to \sphinxhyphen{}180, 180 for consistency. This
behaviour can be toggled by setting \sphinxtitleref{fix\_lon} to False.

\sphinxAtStartPar
Passing additional fields is possible as keyword arguments. For example SST
values can be added to the Record. This could be useful for buddy checking
for example where one would compare SST against neighbour values.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Horizontal coordinate

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Vertical coordinate

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{datetime}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} Datetime of the record

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{uid}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} Unique Identifier

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{fix\_lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Force longitude to \sphinxhyphen{}180, 180

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{**data}} \textendash{} Additional data passed to the Record for use by other functions or
classes.

\end{itemize}

\end{description}\end{quote}
\index{distance() (geotrees.record.Record method)@\spxentry{distance()}\spxextra{geotrees.record.Record method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{record:geotrees.record.Record.distance}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{distance}}}
{\sphinxparam{\DUrole{n}{other}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute the Haversine distance to another Record
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{float}}}

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{SpaceTimeRecord (class in geotrees.record)@\spxentry{SpaceTimeRecord}\spxextra{class in geotrees.record}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{record:geotrees.record.SpaceTimeRecord}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.record.}}\sphinxbfcode{\sphinxupquote{SpaceTimeRecord}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}\sphinxparamcomma \sphinxparam{\DUrole{n}{datetime}}\sphinxparamcomma \sphinxparam{\DUrole{n}{uid}\DUrole{o}{=}\DUrole{default_value}{None}}\sphinxparamcomma \sphinxparam{\DUrole{n}{fix\_lon}\DUrole{o}{=}\DUrole{default_value}{True}}\sphinxparamcomma \sphinxparam{\DUrole{o}{**}\DUrole{n}{data}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A simple instance of a record object, it requires position and temporal
data. It can optionally include a UID and extra data.

\sphinxAtStartPar
The temporal component was designed to use \sphinxtitleref{datetime} values, however all
methods will work with numeric datetime information \sphinxhyphen{} for example a pentad,
timestamp, julian day, etc. Note that any uses within an OctTree and
SpaceTimeRectangle must also have timedelta values replaced with numeric
ranges in this case.

\sphinxAtStartPar
Equality is first checked on uid values, if both Records have a uid value
then the Records are equal if the uids are equal. Otherwise records are
compared by checking only on the required fields \& uid if it is specified.

\sphinxAtStartPar
By default, longitudes are converted to \sphinxhyphen{}180, 180 for consistency. This
behaviour can be toggled by setting \sphinxtitleref{fix\_lon} to False.

\sphinxAtStartPar
Passing additional fields is possible as keyword arguments. For example SST
values can be added to the Record. This could be useful for buddy checking
for example where one would compare SST against neighbour values.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Horizontal coordinate (longitude).

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Vertical coordinate (latitude).

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{datetime}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.datetime}}) \textendash{} Datetime of the record. Can also be a numeric value such as pentad.
Comparisons between Records with datetime and Records with numeric
datetime will fail.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{uid}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} Unique Identifier.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{fix\_lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Force longitude to \sphinxhyphen{}180, 180

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{**data}} \textendash{} Additional data passed to the SpaceTimeRecord for use by other functions
or classes.

\end{itemize}

\end{description}\end{quote}
\index{distance() (geotrees.record.SpaceTimeRecord method)@\spxentry{distance()}\spxextra{geotrees.record.SpaceTimeRecord method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{record:geotrees.record.SpaceTimeRecord.distance}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{distance}}}
{\sphinxparam{\DUrole{n}{other}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute the Haversine distance to another SpaceTimeRecord.
Only computes spatial distance.
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{float}}}

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}


\sphinxstepscope


\chapter{Shape Classes}
\label{\detokenize{shape:shape-classes}}\label{\detokenize{shape::doc}}
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{geotrees.shape}} module defines various classes that can be used to define the boundary for \sphinxcode{\sphinxupquote{QuadTree}}
and \sphinxcode{\sphinxupquote{OctTree}} classes, or query regions for the same.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Rectangle}} and \sphinxcode{\sphinxupquote{SpaceTimeRectangle}} classes are used to define the boundaries for \sphinxcode{\sphinxupquote{QuadTree}} and \sphinxcode{\sphinxupquote{OctTree}}
classes respectively. They are defined by the bounding box in space (and time for a \sphinxcode{\sphinxupquote{SpaceTimeRectangle}}).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Ellipse}} and \sphinxcode{\sphinxupquote{SpaceTimeEllipse}} classes are defined by \sphinxcode{\sphinxupquote{lon}} and \sphinxcode{\sphinxupquote{lat}} indicating the centre of the ellipse, \sphinxcode{\sphinxupquote{a}}
and \sphinxcode{\sphinxupquote{b}} indicating the length of the semi\sphinxhyphen{}major and semi\sphinxhyphen{}minor axes respectively, and \sphinxcode{\sphinxupquote{theta}} indicating the angle
of the ellipse. \sphinxcode{\sphinxupquote{SpaceTimeEllipse}} classes also require \sphinxcode{\sphinxupquote{start}} and \sphinxcode{\sphinxupquote{end}} datetime values. The
\sphinxcode{\sphinxupquote{SpaceTimeEllipse}} is an elliptical cylinder where the height is represented by the time dimension.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Rectangle}} and \sphinxcode{\sphinxupquote{Ellipse}} classes can be used to define a query shape for a \sphinxcode{\sphinxupquote{QuadTree}}, using \sphinxcode{\sphinxupquote{QuadTree.query}}
and \sphinxcode{\sphinxupquote{QuadTree.query\_ellipse}} respectively.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{SpaecTimeRectangle}} and \sphinxcode{\sphinxupquote{SpaceTimeEllipse}} classes can be used to define a query shape for a \sphinxcode{\sphinxupquote{OctTree}}, using
\sphinxcode{\sphinxupquote{OctTree.query}} and \sphinxcode{\sphinxupquote{OctTree.query\_ellipse}} respectively.


\section{Example}
\label{\detokenize{shape:example}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{geotrees}\PYG{n+nn}{.}\PYG{n+nn}{shape}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{Rectangle}\PYG{p}{,} \PYG{n}{SpaceTimeEllipse}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{datetime}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{datetime}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{math}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{pi}

\PYG{n}{rectangle}\PYG{p}{:} \PYG{n}{Rectangle} \PYG{o}{=} \PYG{n}{Rectangle}\PYG{p}{(}
    \PYG{n}{west}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,}
    \PYG{n}{east}\PYG{o}{=}\PYG{l+m+mi}{180}\PYG{p}{,}
    \PYG{n}{south}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{90}\PYG{p}{,}
    \PYG{n}{north}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{,}
\PYG{p}{)}

\PYG{n}{ellipse}\PYG{p}{:} \PYG{n}{SpaceTimeEllipse} \PYG{o}{=} \PYG{n}{SpaceTimeEllipse}\PYG{p}{(}
    \PYG{n}{lon}\PYG{o}{=}\PYG{l+m+mf}{23.4}\PYG{p}{,}
    \PYG{n}{lat}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{17.9}\PYG{p}{,}
    \PYG{n}{a}\PYG{o}{=}\PYG{l+m+mi}{103}\PYG{p}{,}
    \PYG{n}{b}\PYG{o}{=}\PYG{l+m+mi}{71}\PYG{p}{,}
    \PYG{n}{theta}\PYG{o}{=}\PYG{n}{pi}\PYG{o}{/}\PYG{l+m+mi}{3}\PYG{p}{,}
    \PYG{n}{start}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{13}\PYG{p}{,} \PYG{l+m+mi}{19}\PYG{p}{,} \PYG{l+m+mi}{30}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{end}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2010}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{45}\PYG{p}{)}\PYG{p}{,}
\PYG{p}{)}
\end{sphinxVerbatim}


\section{shape Module}
\label{\detokenize{shape:module-geotrees.shape}}\label{\detokenize{shape:shape-module}}\index{module@\spxentry{module}!geotrees.shape@\spxentry{geotrees.shape}}\index{geotrees.shape@\spxentry{geotrees.shape}!module@\spxentry{module}}
\sphinxAtStartPar
Shape objects for defining QuadTree or OctTree classes, or for defining a query
region for QuadTree and OctTree classes.

\sphinxAtStartPar
Distances between shapes, or between shapes and Records uses the Haversine
distance.

\sphinxAtStartPar
All shape objects account for spherical geometry and the wrapping of longitude
at \sphinxhyphen{}180, 180 degrees.

\sphinxAtStartPar
Classes prefixed by “SpaceTime” include a temporal dimension and should be used
with OctTree classes.
\index{Ellipse (class in geotrees.shape)@\spxentry{Ellipse}\spxextra{class in geotrees.shape}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Ellipse}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.shape.}}\sphinxbfcode{\sphinxupquote{Ellipse}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}\sphinxparamcomma \sphinxparam{\DUrole{n}{a}}\sphinxparamcomma \sphinxparam{\DUrole{n}{b}}\sphinxparamcomma \sphinxparam{\DUrole{n}{theta}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A simple Ellipse Class for an ellipse on the surface of a sphere.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Horizontal centre of the Ellipse

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Vertical centre of the Ellipse

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{a}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Length of the semi\sphinxhyphen{}major axis

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{b}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Length of the semi\sphinxhyphen{}minor axis

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{theta}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Angle of the semi\sphinxhyphen{}major axis from horizontal anti\sphinxhyphen{}clockwise in radians

\end{itemize}

\end{description}\end{quote}
\index{contains() (geotrees.shape.Ellipse method)@\spxentry{contains()}\spxextra{geotrees.shape.Ellipse method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Ellipse.contains}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{contains}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if a Record is contained within the Ellipse
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{nearby\_rect() (geotrees.shape.Ellipse method)@\spxentry{nearby\_rect()}\spxextra{geotrees.shape.Ellipse method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Ellipse.nearby_rect}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{nearby\_rect}}}
{\sphinxparam{\DUrole{n}{rect}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if a Rectangle is near to the Ellipse
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{Rectangle (class in geotrees.shape)@\spxentry{Rectangle}\spxextra{class in geotrees.shape}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.shape.}}\sphinxbfcode{\sphinxupquote{Rectangle}}}
{\sphinxparam{\DUrole{n}{west}}\sphinxparamcomma \sphinxparam{\DUrole{n}{east}}\sphinxparamcomma \sphinxparam{\DUrole{n}{south}}\sphinxparamcomma \sphinxparam{\DUrole{n}{north}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A simple Rectangle class for GeoSpatial analysis. Defined by a bounding box.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{west}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Western boundary of the Rectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{east}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Eastern boundary of the Rectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{south}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Southern boundary of the Rectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{north}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Northern boundary of the Rectangle

\end{itemize}

\end{description}\end{quote}
\index{contains() (geotrees.shape.Rectangle method)@\spxentry{contains()}\spxextra{geotrees.shape.Rectangle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.contains}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{contains}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if a Record is contained within the Rectangle
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{edge\_dist (geotrees.shape.Rectangle property)@\spxentry{edge\_dist}\spxextra{geotrees.shape.Rectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.edge_dist}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{edge\_dist}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Approximate maximum distance from the centre to an edge

\end{fulllineitems}

\index{intersects() (geotrees.shape.Rectangle method)@\spxentry{intersects()}\spxextra{geotrees.shape.Rectangle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.intersects}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{intersects}}}
{\sphinxparam{\DUrole{n}{other}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if another Rectangle object intersects this Rectangle
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{lat (geotrees.shape.Rectangle property)@\spxentry{lat}\spxextra{geotrees.shape.Rectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.lat}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lat}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Centre latitude of the Rectangle

\end{fulllineitems}

\index{lat\_range (geotrees.shape.Rectangle property)@\spxentry{lat\_range}\spxextra{geotrees.shape.Rectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.lat_range}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lat\_range}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Latitude range of the Rectangle

\end{fulllineitems}

\index{lon (geotrees.shape.Rectangle property)@\spxentry{lon}\spxextra{geotrees.shape.Rectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.lon}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lon}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Centre longitude of the Rectangle

\end{fulllineitems}

\index{lon\_range (geotrees.shape.Rectangle property)@\spxentry{lon\_range}\spxextra{geotrees.shape.Rectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.lon_range}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lon\_range}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Longitude range of the Rectangle

\end{fulllineitems}

\index{nearby() (geotrees.shape.Rectangle method)@\spxentry{nearby()}\spxextra{geotrees.shape.Rectangle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.Rectangle.nearby}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{nearby}}}
{\sphinxparam{\DUrole{n}{point}}\sphinxparamcomma \sphinxparam{\DUrole{n}{dist}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Check if Record is nearby the Rectangle
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{SpaceTimeEllipse (class in geotrees.shape)@\spxentry{SpaceTimeEllipse}\spxextra{class in geotrees.shape}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeEllipse}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.shape.}}\sphinxbfcode{\sphinxupquote{SpaceTimeEllipse}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}\sphinxparamcomma \sphinxparam{\DUrole{n}{a}}\sphinxparamcomma \sphinxparam{\DUrole{n}{b}}\sphinxparamcomma \sphinxparam{\DUrole{n}{theta}}\sphinxparamcomma \sphinxparam{\DUrole{n}{start}}\sphinxparamcomma \sphinxparam{\DUrole{n}{end}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A simple SpaceTimeEllipse Class for an ellipse on the surface of a sphere
with an additional time dimension.

\sphinxAtStartPar
The representation of the shape is an elliptical cylinder, with the time
dimension representing the height of the cylinder.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Horizontal centre of the SpaceTimeEllipse

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Vertical centre of the SpaceTimeEllipse

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{a}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Length of the semi\sphinxhyphen{}major axis

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{b}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Length of the semi\sphinxhyphen{}minor axis

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{theta}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Angle of the semi\sphinxhyphen{}major axis from horizontal anti\sphinxhyphen{}clockwise in radians

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{start}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.datetime}}) \textendash{} Start date of the SpaceTimeEllipse

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{end}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.datetime}}) \textendash{} Send date of the SpaceTimeEllipse

\end{itemize}

\end{description}\end{quote}
\index{contains() (geotrees.shape.SpaceTimeEllipse method)@\spxentry{contains()}\spxextra{geotrees.shape.SpaceTimeEllipse method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeEllipse.contains}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{contains}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if a SpaceTimeRecord is contained within the SpaceTimeEllipse
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{nearby\_rect() (geotrees.shape.SpaceTimeEllipse method)@\spxentry{nearby\_rect()}\spxextra{geotrees.shape.SpaceTimeEllipse method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeEllipse.nearby_rect}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{nearby\_rect}}}
{\sphinxparam{\DUrole{n}{rect}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if a SpaceTimeRectangle is near to the SpaceTimeEllipse
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{SpaceTimeRectangle (class in geotrees.shape)@\spxentry{SpaceTimeRectangle}\spxextra{class in geotrees.shape}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.shape.}}\sphinxbfcode{\sphinxupquote{SpaceTimeRectangle}}}
{\sphinxparam{\DUrole{n}{west}}\sphinxparamcomma \sphinxparam{\DUrole{n}{east}}\sphinxparamcomma \sphinxparam{\DUrole{n}{south}}\sphinxparamcomma \sphinxparam{\DUrole{n}{north}}\sphinxparamcomma \sphinxparam{\DUrole{n}{start}}\sphinxparamcomma \sphinxparam{\DUrole{n}{end}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A simple SpaceTimeRectangle class for GeoSpatial analysis. Defined by a
bounding box in space and time.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{west}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Western boundary of the SpaceTimeRectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{east}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Eastern boundary of the SpaceTimeRectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{south}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Southern boundary of the SpaceTimeRectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{north}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Northern boundary of the SpaceTimeRectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{start}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.datetime}}) \textendash{} Start datetime of the SpaceTimeRectangle

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{end}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.datetime}}) \textendash{} End datetime of the SpaceTimeRectangle

\end{itemize}

\end{description}\end{quote}
\index{centre\_datetime (geotrees.shape.SpaceTimeRectangle property)@\spxentry{centre\_datetime}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.centre_datetime}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{centre\_datetime}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }datetime}}}
\pysigstopsignatures
\sphinxAtStartPar
The midpoint time of the SpaceTimeRectangle

\end{fulllineitems}

\index{contains() (geotrees.shape.SpaceTimeRectangle method)@\spxentry{contains()}\spxextra{geotrees.shape.SpaceTimeRectangle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.contains}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{contains}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if a SpaceTimeRecord is contained within the SpaceTimeRectangle
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{edge\_dist (geotrees.shape.SpaceTimeRectangle property)@\spxentry{edge\_dist}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.edge_dist}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{edge\_dist}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Approximate maximum distance from the centre to an edge

\end{fulllineitems}

\index{intersects() (geotrees.shape.SpaceTimeRectangle method)@\spxentry{intersects()}\spxextra{geotrees.shape.SpaceTimeRectangle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.intersects}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{intersects}}}
{\sphinxparam{\DUrole{n}{other}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Test if another SpaceTimeRectangle object intersects this
SpaceTimeRectangle.
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{lat (geotrees.shape.SpaceTimeRectangle property)@\spxentry{lat}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.lat}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lat}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Centre latitude of the SpaceTimeRectangle

\end{fulllineitems}

\index{lat\_range (geotrees.shape.SpaceTimeRectangle property)@\spxentry{lat\_range}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.lat_range}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lat\_range}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Latitude range of the SpaceTimeRectangle

\end{fulllineitems}

\index{lon (geotrees.shape.SpaceTimeRectangle property)@\spxentry{lon}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.lon}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lon}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Centre longitude of the SpaceTimeRectangle

\end{fulllineitems}

\index{lon\_range (geotrees.shape.SpaceTimeRectangle property)@\spxentry{lon\_range}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.lon_range}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{lon\_range}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }float}}}
\pysigstopsignatures
\sphinxAtStartPar
Longitude range of the SpaceTimeRectangle

\end{fulllineitems}

\index{nearby() (geotrees.shape.SpaceTimeRectangle method)@\spxentry{nearby()}\spxextra{geotrees.shape.SpaceTimeRectangle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.nearby}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{nearby}}}
{\sphinxparam{\DUrole{n}{point}}\sphinxparamcomma \sphinxparam{\DUrole{n}{dist}}\sphinxparamcomma \sphinxparam{\DUrole{n}{t\_dist}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Check if SpaceTimeRecord is nearby the SpaceTimeRectangle

\sphinxAtStartPar
Determines if a SpaceTimeRecord that falls on the surface of Earth is
nearby to the rectangle in space and time. This calculation uses the
Haversine distance metric.

\sphinxAtStartPar
Distance from rectangle to point is challenging on the surface of a
sphere, this calculation will return false positives as a check based
on the distance from the centre of the rectangle to the corners, or
to its Eastern edge (if the rectangle crosses the equator) is used in
combination with the input distance.

\sphinxAtStartPar
The primary use\sphinxhyphen{}case of this method is for querying an OctTree for
nearby SpaceTimeRecords.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRecord}}}}})

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{dist}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}\sphinxstyleliteralemphasis{\sphinxupquote{,}})

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{t\_dist}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.timedelta}})

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
\sphinxstylestrong{bool}

\sphinxlineitem{Return type}
\sphinxAtStartPar
True if the point is \textless{}= dist + max(dist(centre, corners))

\end{description}\end{quote}

\end{fulllineitems}

\index{time\_range (geotrees.shape.SpaceTimeRectangle property)@\spxentry{time\_range}\spxextra{geotrees.shape.SpaceTimeRectangle property}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{shape:geotrees.shape.SpaceTimeRectangle.time_range}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{property}\DUrole{w}{ }}}\sphinxbfcode{\sphinxupquote{time\_range}}\sphinxbfcode{\sphinxupquote{\DUrole{p}{:}\DUrole{w}{ }timedelta}}}
\pysigstopsignatures
\sphinxAtStartPar
The time extent of the Rectangle

\end{fulllineitems}


\end{fulllineitems}


\sphinxstepscope


\chapter{Quadtree}
\label{\detokenize{quadtree:quadtree}}\label{\detokenize{quadtree::doc}}
\sphinxAtStartPar
A Quadtree is a data\sphinxhyphen{}structure where each internal node has exactly four branches, and are used to recursively partition
a two\sphinxhyphen{}dimensional spatial domain. Each branch note is itself a Quadtree, whose spatial domain represents one of the
quadrants (north\sphinxhyphen{}west, north\sphinxhyphen{}east, south\sphinxhyphen{}west, south\sphinxhyphen{}east) of its parent’s domain. The partitioning of data in this way
is dependent on the spatial density of data inserted into the Quadtree. The Quadtree is typically initialised with a
capacity value, once the capacity is reached (by inserting data points), the Quadtree divides and subsequent data points
are added to the appropriate branch\sphinxhyphen{}node.

\sphinxAtStartPar
Quadtree structures allow for fast identification of data within some query region. The structure of the tree ensures
that only nodes whose domain boundary intersects (or contains or is contained by) the query region are evaluated. The
time\sphinxhyphen{}complexity of these query operations is \(O(\log(n))\), the space\sphinxhyphen{}complexity of a Quadtree is \(O(n)\).

\sphinxAtStartPar
Typically, it is assumed that the data uses a cartesian coordinate system, so comparisons between boundaries and query
shapes utilise cartesian geometry and euclidean distances. The implementation of Quadtree within this library, the
\sphinxcode{\sphinxupquote{QuadTree}} class, utilises the Haversine distance as a metric for identifying records within the queried region.
This allows the Quadtree to account for the spherical geometry of the Earth. Boundary checks with query regions also
account for the wrapping of longitude at \sphinxhyphen{}180, 180 degrees.

\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{QuadTree}} object is defined by a bounding box, i.e. boundaries at the western, eastern, southern, and northern edges of
the data that will be inserted into the \sphinxcode{\sphinxupquote{QuadTree}}. Additionally, a capacity and maximum depth can be provided. If the
capacity is exceeded whilst inserting records the \sphinxcode{\sphinxupquote{QuadTree}} will divide and new records will be inserted into the appropriate
branch \sphinxcode{\sphinxupquote{QuadTree}}. The maximum depth is the maximum height of the \sphinxcode{\sphinxupquote{QuadTree}}, if capacity is also specified then this will be
overridden if the \sphinxcode{\sphinxupquote{QuadTree}} is at this depth, and the \sphinxcode{\sphinxupquote{QuadTree}} will not divide.


\section{Documentation}
\label{\detokenize{quadtree:documentation}}

\subsection{Inserting Records}
\label{\detokenize{quadtree:inserting-records}}
\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{Record}} can be added to an \sphinxcode{\sphinxupquote{QuadTree}} with \sphinxcode{\sphinxupquote{QuadTree.insert}} which will return \sphinxcode{\sphinxupquote{True}} if the operation
was successful, \sphinxcode{\sphinxupquote{False}} otherwise. The \sphinxcode{\sphinxupquote{QuadTree}} is modified in place.


\subsection{Removing Records}
\label{\detokenize{quadtree:removing-records}}
\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{Record}} can be removed from an \sphinxcode{\sphinxupquote{QuadTree}} with \sphinxcode{\sphinxupquote{QuadTree.remove}} which will return \sphinxcode{\sphinxupquote{True}} if the operation
was successful, \sphinxcode{\sphinxupquote{False}} otherwise. The \sphinxcode{\sphinxupquote{QuadTree}} is modified in place.


\subsection{Querying}
\label{\detokenize{quadtree:querying}}
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{QuadTree}} class defined in \sphinxcode{\sphinxupquote{geotrees.quadtree}} can be queried in the following ways:
\begin{itemize}
\item {}
\sphinxAtStartPar
with a \sphinxcode{\sphinxupquote{Record}}, a spatial range with \sphinxcode{\sphinxupquote{QuadTree.nearby\_points}}. All points within the spatial range of the
\sphinxcode{\sphinxupquote{Record}} will be returned in a list. The \sphinxcode{\sphinxupquote{Record}} can be excluded from the results if the \sphinxcode{\sphinxupquote{exclude\_self}}
argument is set.

\item {}
\sphinxAtStartPar
with a \sphinxcode{\sphinxupquote{Rectangle}} using \sphinxcode{\sphinxupquote{QuadTree.query}}. All points within the specified \sphinxcode{\sphinxupquote{Rectangle}} will be returned in a list.

\item {}
\sphinxAtStartPar
with a \sphinxcode{\sphinxupquote{Ellipse}} using \sphinxcode{\sphinxupquote{QuadTree.query\_ellipse}}. All points within the specified \sphinxcode{\sphinxupquote{Ellipse}} will be returned in a list.

\end{itemize}


\section{Example}
\label{\detokenize{quadtree:example}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{geotrees}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{QuadTree}\PYG{p}{,} \PYG{n}{Record}\PYG{p}{,} \PYG{n}{Rectangle}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{random}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{choice}

\PYG{n}{lon\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,} \PYG{l+m+mi}{180}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lat\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{90}\PYG{p}{,} \PYG{l+m+mi}{90}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{N\PYGZus{}samples} \PYG{o}{=} \PYG{l+m+mi}{1000}

\PYG{c+c1}{\PYGZsh{} Construct Tree}
\PYG{n}{boundary} \PYG{o}{=} \PYG{n}{Rectangle}\PYG{p}{(}
    \PYG{n}{west}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,}
    \PYG{n}{east}\PYG{o}{=}\PYG{l+m+mi}{180}\PYG{p}{,}
    \PYG{n}{south}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{90}\PYG{p}{,}
    \PYG{n}{north}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{,}
\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Full domain}
\PYG{n}{quadtree} \PYG{o}{=} \PYG{n}{QuadTree}\PYG{p}{(}\PYG{n}{boundary}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Populate the tree}
\PYG{n}{records}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n}{Record}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}
    \PYG{n}{Record}\PYG{p}{(}
        \PYG{n}{choice}\PYG{p}{(}\PYG{n}{lon\PYGZus{}range}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{choice}\PYG{p}{(}\PYG{n}{lat\PYGZus{}range}\PYG{p}{)}\PYG{p}{,}
    \PYG{p}{)} \PYG{k}{for} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N\PYGZus{}samples}\PYG{p}{)}
\PYG{p}{]}
\PYG{k}{for} \PYG{n}{record} \PYG{o+ow}{in} \PYG{n}{records}\PYG{p}{:}
    \PYG{n}{quadtree}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{n}{record}\PYG{p}{)}

\PYG{n}{dist}\PYG{p}{:} \PYG{n+nb}{float} \PYG{o}{=} \PYG{l+m+mi}{340}  \PYG{c+c1}{\PYGZsh{} km}

\PYG{c+c1}{\PYGZsh{} Find all Records that are 340km away from test\PYGZus{}value}
\PYG{n}{neighbours}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n}{Record}\PYG{p}{]} \PYG{o}{=} \PYG{n}{quadtree}\PYG{o}{.}\PYG{n}{nearby\PYGZus{}points}\PYG{p}{(}\PYG{n}{test\PYGZus{}value}\PYG{p}{,} \PYG{n}{dist}\PYG{p}{)}
\end{sphinxVerbatim}


\section{quadtree Module}
\label{\detokenize{quadtree:module-geotrees.quadtree}}\label{\detokenize{quadtree:quadtree-module}}\index{module@\spxentry{module}!geotrees.quadtree@\spxentry{geotrees.quadtree}}\index{geotrees.quadtree@\spxentry{geotrees.quadtree}!module@\spxentry{module}}
\sphinxAtStartPar
Constructors for QuadTree classes that can decrease the number of comparisons
for detecting nearby records for example. This is an implementation that uses
Haversine distances for comparisons between records for identification of
neighbours.
\index{QuadTree (class in geotrees.quadtree)@\spxentry{QuadTree}\spxextra{class in geotrees.quadtree}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.quadtree.}}\sphinxbfcode{\sphinxupquote{QuadTree}}}
{\sphinxparam{\DUrole{n}{boundary}}\sphinxparamcomma \sphinxparam{\DUrole{n}{capacity}\DUrole{o}{=}\DUrole{default_value}{5}}\sphinxparamcomma \sphinxparam{\DUrole{n}{depth}\DUrole{o}{=}\DUrole{default_value}{0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{max\_depth}\DUrole{o}{=}\DUrole{default_value}{None}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Acts as a Geo\sphinxhyphen{}spatial QuadTree on the surface of Earth, allowing
for querying nearby points faster than searching a full DataFrame. As
Records are added to the QuadTree, the QuadTree divides into 4 branches as
the capacity is reached, points contained within the QuadTree are not
distributed to the branch QuadTrees. Additional Records are then added to
the branch where they fall within the branch QuadTree’s boundary.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{boundary}} ({\hyperref[\detokenize{shape:geotrees.shape.Rectangle}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Rectangle}}}}}) \textendash{} The bounding Rectangle of the QuadTree

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{capacity}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \textendash{} The capacity of each cell, if max\_depth is set then a cell at the
maximum depth may contain more points than the capacity.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{depth}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \textendash{} The current depth of the cell. Initialises to zero if unset.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{max\_depth}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} The maximum depth of the QuadTree. If set, this can override the
capacity for cells at the maximum depth.

\end{itemize}

\end{description}\end{quote}
\index{divide() (geotrees.quadtree.QuadTree method)@\spxentry{divide()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.divide}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{divide}}}
{}
{}
\pysigstopsignatures
\sphinxAtStartPar
Divide the QuadTree
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{None}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{insert() (geotrees.quadtree.QuadTree method)@\spxentry{insert()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.insert}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{insert}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Insert a point into the QuadTree.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Record}}}}}) \textendash{} The point to insert

\sphinxlineitem{Returns}
\sphinxAtStartPar
True if the point was inserted into the QuadTree

\sphinxlineitem{Return type}
\sphinxAtStartPar
bool

\end{description}\end{quote}

\end{fulllineitems}

\index{insert\_into\_branch() (geotrees.quadtree.QuadTree method)@\spxentry{insert\_into\_branch()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.insert_into_branch}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{insert\_into\_branch}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Insert a point into a branch QuadTree.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Record}}}}}) \textendash{} The point to insert

\sphinxlineitem{Returns}
\sphinxAtStartPar
True if the point was inserted into a branch QuadTree

\sphinxlineitem{Return type}
\sphinxAtStartPar
bool

\end{description}\end{quote}

\end{fulllineitems}

\index{len() (geotrees.quadtree.QuadTree method)@\spxentry{len()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.len}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{len}}}
{\sphinxparam{\DUrole{n}{current\_len}\DUrole{o}{=}\DUrole{default_value}{0}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get the number of points in the QuadTree
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{int}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{nearby\_points() (geotrees.quadtree.QuadTree method)@\spxentry{nearby\_points()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.nearby_points}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{nearby\_points}}}
{\sphinxparam{\DUrole{n}{point}}\sphinxparamcomma \sphinxparam{\DUrole{n}{dist}}\sphinxparamcomma \sphinxparam{\DUrole{n}{points}\DUrole{o}{=}\DUrole{default_value}{None}}\sphinxparamcomma \sphinxparam{\DUrole{n}{exclude\_self}\DUrole{o}{=}\DUrole{default_value}{False}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get all Records contained in the QuadTree that are nearby
another query Record.

\sphinxAtStartPar
Query the QuadTree to find all Records within the QuadTree that
are nearby to the query Record. This search should be faster
than searching through all records, since only QuadTree branch whose
boundaries are close to the query Record are evaluated.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Record}}}}}) \textendash{} The query point.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{dist}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} The distance for comparison. Note that Haversine distance is used
as the distance metric as the query Record and QuadTree are
assumed to lie on the surface of Earth.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{points}} (\sphinxstyleliteralemphasis{\sphinxupquote{Records}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} List of Records already found. Most use cases will be to
not set this value, since it’s main use is for passing onto the
branch QuadTrees.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{exclude\_self}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Optionally exclude the query point from the results if the query
point is in the OctTree

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
A list of Records whose distance to the
query Record is \textless{}= dist, and the datetimes of the
Records fall within the datetime range of the query
Record.

\sphinxlineitem{Return type}
\sphinxAtStartPar
list{[}{\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{Record}}}{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{query() (geotrees.quadtree.QuadTree method)@\spxentry{query()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.query}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{query}}}
{\sphinxparam{\DUrole{n}{rect}}\sphinxparamcomma \sphinxparam{\DUrole{n}{points}\DUrole{o}{=}\DUrole{default_value}{None}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get Records contained within the QuadTree that fall in a
Rectangle
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{rect}} ({\hyperref[\detokenize{shape:geotrees.shape.Rectangle}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Rectangle}}}}})

\sphinxlineitem{Returns}
\sphinxAtStartPar
The Record values contained within the QuadTree that fall
within the bounds of rect.

\sphinxlineitem{Return type}
\sphinxAtStartPar
list{[}{\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{Record}}}{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{query\_ellipse() (geotrees.quadtree.QuadTree method)@\spxentry{query\_ellipse()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.query_ellipse}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{query\_ellipse}}}
{\sphinxparam{\DUrole{n}{ellipse}}\sphinxparamcomma \sphinxparam{\DUrole{n}{points}\DUrole{o}{=}\DUrole{default_value}{None}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get Records contained within the QuadTree that fall in a
Ellipse
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{ellipse}} ({\hyperref[\detokenize{shape:geotrees.shape.Ellipse}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Ellipse}}}}})

\sphinxlineitem{Returns}
\sphinxAtStartPar
The Record values contained within the QuadTree that fall
within the bounds of ellipse.

\sphinxlineitem{Return type}
\sphinxAtStartPar
list{[}{\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{Record}}}{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{redistribute\_to\_branches() (geotrees.quadtree.QuadTree method)@\spxentry{redistribute\_to\_branches()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.redistribute_to_branches}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{redistribute\_to\_branches}}}
{}
{}
\pysigstopsignatures
\sphinxAtStartPar
Redistribute all points to branches
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{None}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{remove() (geotrees.quadtree.QuadTree method)@\spxentry{remove()}\spxextra{geotrees.quadtree.QuadTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{quadtree:geotrees.quadtree.QuadTree.remove}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{remove}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Remove a Record from the QuadTree if it is in the QuadTree.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Record}}}}}) \textendash{} The point to remove

\sphinxlineitem{Returns}
\sphinxAtStartPar
True if the point is removed

\sphinxlineitem{Return type}
\sphinxAtStartPar
bool

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}


\sphinxstepscope


\chapter{OctTree}
\label{\detokenize{octtree:octtree}}\label{\detokenize{octtree::doc}}
\sphinxAtStartPar
An Octtree is an extension of the Quadtree into a third dimension. In standard Octtree implementations the third
dimension is treated as another spatial dimension, in that distance checks are performed using Euclidean distances.
Here, the third dimension is considered to be a time dimension. Any look\sphinxhyphen{}ups using the Octtree require a timedelta to be
provided, so that any records falling within the spatial range are returned only if they also fall within the time range
defined by the timedelta.

\sphinxAtStartPar
Whilst the Quadtree divides into 4 branches after the capacity is reached, the Octtree divides into 8 branches. The
divisions are at the longitude midpoint, the latitude midpoint, and the datetime midpoint of the boundary.

\sphinxAtStartPar
The implementation of Octtree within this library, the \sphinxcode{\sphinxupquote{OctTree}} class, utilises the Haversine distance as a metric
for identifying records within the queried region. This allows the Octtree to account for the spherical geometry of the
Earth. Boundary checks with query regions also account for the wrapping of longitude at \sphinxhyphen{}180, 180 degrees.

\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{OctTree}} object is defined by a bounding box in space and time, i.e. boundaries at the western, eastern,
southern, and northern edges as well as the start and end datetimes of the data that will be inserted into the \sphinxcode{\sphinxupquote{OctTree}}.
Additionally, a capacity and maximum depth can be provided. If the capacity is exceeded whilst inserting records the
\sphinxcode{\sphinxupquote{OctTree}} will divide and new records will be inserted into the appropriate branch \sphinxcode{\sphinxupquote{OctTree}}. The maximum depth is the
maximum height of the \sphinxcode{\sphinxupquote{OctTree}}, if capacity is also specified then this will be overridden if the \sphinxcode{\sphinxupquote{OctTree}} is at this
depth, and the \sphinxcode{\sphinxupquote{OctTree}} will not divide.


\section{Documentation}
\label{\detokenize{octtree:documentation}}

\subsection{Inserting Records}
\label{\detokenize{octtree:inserting-records}}
\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{SpaceTimeRecord}} can be added to an \sphinxcode{\sphinxupquote{OctTree}} with \sphinxcode{\sphinxupquote{OctTree.insert}} which will return \sphinxcode{\sphinxupquote{True}} if the operation
was successful, \sphinxcode{\sphinxupquote{False}} otherwise. The \sphinxcode{\sphinxupquote{OctTree}} is modified in place. Records that fall outside the bounds of the
\sphinxcode{\sphinxupquote{OctTree}} will not be inserted as the boundary is fixed.


\subsection{Removing Records}
\label{\detokenize{octtree:removing-records}}
\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{SpaceTimeRecord}} can be removed from an \sphinxcode{\sphinxupquote{OctTree}} with \sphinxcode{\sphinxupquote{OctTree.remove}} which will return \sphinxcode{\sphinxupquote{True}} if the operation
was successful, \sphinxcode{\sphinxupquote{False}} otherwise. The \sphinxcode{\sphinxupquote{OctTree}} is modified in place.


\subsection{Querying}
\label{\detokenize{octtree:querying}}
\sphinxAtStartPar
The \sphinxcode{\sphinxupquote{OctTree}} class defined in \sphinxcode{\sphinxupquote{geotrees.octtree}} can be queried in the following ways:
\begin{itemize}
\item {}
\sphinxAtStartPar
with a \sphinxcode{\sphinxupquote{SpaceTimeRecord}}, a spatial range, and a time range (specified by a \sphinxcode{\sphinxupquote{datetime.timedelta}}) with
\sphinxcode{\sphinxupquote{OctTree.nearby\_points}}. All points within the spatial range and time range of the \sphinxcode{\sphinxupquote{SpaceTimeRecord}} will be
returned in a list. The \sphinxcode{\sphinxupquote{Record}} can be excluded from the results if the \sphinxcode{\sphinxupquote{exclude\_self}}
argument is set.

\item {}
\sphinxAtStartPar
with a \sphinxcode{\sphinxupquote{SpaceTimeRectangle}} using \sphinxcode{\sphinxupquote{OctTree.query}}. All points within the specified \sphinxcode{\sphinxupquote{SpaceTimeRectangle}} will be returned in a list.

\item {}
\sphinxAtStartPar
with a \sphinxcode{\sphinxupquote{SpaceTimeEllipse}} using \sphinxcode{\sphinxupquote{OctTree.query\_ellipse}}. All points within the specified \sphinxcode{\sphinxupquote{SpaceTimeEllipse}} will be returned in a list.

\end{itemize}


\section{Example}
\label{\detokenize{octtree:example}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{geotrees}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{OctTree}\PYG{p}{,} \PYG{n}{SpaceTimeRecord}\PYG{p}{,} \PYG{n}{SpaceTimeRectangle}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{datetime}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{datetime}\PYG{p}{,} \PYG{n}{timedelta}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{random}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{choice}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{polars}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{datetime\PYGZus{}range}

\PYG{n}{lon\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,} \PYG{l+m+mi}{180}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lat\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{90}\PYG{p}{,} \PYG{l+m+mi}{90}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{dates} \PYG{o}{=} \PYG{n}{datetime\PYGZus{}range}\PYG{p}{(}
    \PYG{n}{start}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{end}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{interval}\PYG{o}{=}\PYG{n}{timedelta}\PYG{p}{(}\PYG{n}{hours}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{closed}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{left}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{eager}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
\PYG{p}{)}
\PYG{n}{N\PYGZus{}samples} \PYG{o}{=} \PYG{l+m+mi}{1000}

\PYG{c+c1}{\PYGZsh{} Construct Tree}
\PYG{n}{boundary} \PYG{o}{=} \PYG{n}{SpaceTimeRectangle}\PYG{p}{(}
    \PYG{n}{west}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,}
    \PYG{n}{east}\PYG{o}{=}\PYG{l+m+mi}{180}\PYG{p}{,}
    \PYG{n}{south}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{90}\PYG{p}{,}
    \PYG{n}{north}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{,}
    \PYG{n}{start}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}
    \PYG{n}{end}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{23}\PYG{p}{)}\PYG{p}{,}
\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Full domain}
\PYG{n}{octtree} \PYG{o}{=} \PYG{n}{OctTree}\PYG{p}{(}\PYG{n}{boundary}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Populate the tree}
\PYG{n}{records}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n}{SpaceTimeRecord}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}
    \PYG{n}{SpaceTimeRecord}\PYG{p}{(}
        \PYG{n}{choice}\PYG{p}{(}\PYG{n}{lon\PYGZus{}range}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{choice}\PYG{p}{(}\PYG{n}{lat\PYGZus{}range}\PYG{p}{)}\PYG{p}{,}
        \PYG{n}{choice}\PYG{p}{(}\PYG{n}{dates}\PYG{p}{)}
    \PYG{p}{)} \PYG{k}{for} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N\PYGZus{}samples}\PYG{p}{)}
\PYG{p}{]}
\PYG{k}{for} \PYG{n}{record} \PYG{o+ow}{in} \PYG{n}{records}\PYG{p}{:}
    \PYG{n}{octtree}\PYG{o}{.}\PYG{n}{insert}\PYG{p}{(}\PYG{n}{record}\PYG{p}{)}

\PYG{n}{test\PYGZus{}value}\PYG{p}{:} \PYG{n}{SpaceTimeRecord} \PYG{o}{=} \PYG{n}{SpaceTimeRecord}\PYG{p}{(}
    \PYG{n}{lon}\PYG{o}{=}\PYG{l+m+mf}{47.6}\PYG{p}{,} \PYG{n}{lat}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{31.1}\PYG{p}{,} \PYG{n}{datetime}\PYG{o}{=}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2009}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{23}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{41}\PYG{p}{)}
\PYG{p}{)}
\PYG{n}{dist}\PYG{p}{:} \PYG{n+nb}{float} \PYG{o}{=} \PYG{l+m+mi}{340}  \PYG{c+c1}{\PYGZsh{} km}
\PYG{n}{t\PYGZus{}dist} \PYG{o}{=} \PYG{n}{timedelta}\PYG{p}{(}\PYG{n}{hours}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Find all Records that are 340km away from test\PYGZus{}value, and within 4 hours}
\PYG{c+c1}{\PYGZsh{} of test\PYGZus{}value}
\PYG{n}{neighbours}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n}{SpaceTimeRecord}\PYG{p}{]} \PYG{o}{=} \PYG{n}{octtree}\PYG{o}{.}\PYG{n}{nearby\PYGZus{}points}\PYG{p}{(}
    \PYG{n}{test\PYGZus{}value}\PYG{p}{,} \PYG{n}{dist}\PYG{p}{,} \PYG{n}{t\PYGZus{}dist}
\PYG{p}{)}
\end{sphinxVerbatim}


\section{octtree Module}
\label{\detokenize{octtree:module-geotrees.octtree}}\label{\detokenize{octtree:octtree-module}}\index{module@\spxentry{module}!geotrees.octtree@\spxentry{geotrees.octtree}}\index{geotrees.octtree@\spxentry{geotrees.octtree}!module@\spxentry{module}}
\sphinxAtStartPar
Constructors for OctTree classes that can decrease the number of comparisons
for detecting nearby records for example. This is an implementation that uses
Haversine distances for comparisons between records for identification of
neighbours.
\index{OctTree (class in geotrees.octtree)@\spxentry{OctTree}\spxextra{class in geotrees.octtree}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.octtree.}}\sphinxbfcode{\sphinxupquote{OctTree}}}
{\sphinxparam{\DUrole{n}{boundary}}\sphinxparamcomma \sphinxparam{\DUrole{n}{capacity}\DUrole{o}{=}\DUrole{default_value}{5}}\sphinxparamcomma \sphinxparam{\DUrole{n}{depth}\DUrole{o}{=}\DUrole{default_value}{0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{max\_depth}\DUrole{o}{=}\DUrole{default_value}{None}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Acts as a space\sphinxhyphen{}time OctTree on the surface of Earth, allowing for querying
nearby points faster than searching a full DataFrame. As SpaceTimeRecords
are added to the OctTree, the OctTree divides into 8 branches as the
capacity is reached, points within the OctTree are not distributed to the
branch OctTrees. Additional SpaceTimeRecords are then added to the branch
where they fall within the branch OctTree’s boundary.

\sphinxAtStartPar
Whilst the OctTree has a temporal component, and was designed to utilise
datetime / timedelta objects, numeric values and ranges can be used. This
usage must be consistent for the boundary and all SpaceTimeRecords that
are part of the OctTree. This allows for usage of pentad, timestamp,
Julian day, etc. as datetime values.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{boundary}} ({\hyperref[\detokenize{shape:geotrees.shape.SpaceTimeRectangle}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRectangle}}}}}) \textendash{} The bounding SpaceTimeRectangle of the QuadTree

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{capacity}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \textendash{} The capacity of each cell, if max\_depth is set then a cell at the
maximum depth may contain more points than the capacity.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{depth}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \textendash{} The current depth of the cell. Initialises to zero if unset.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{max\_depth}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}\sphinxstyleliteralemphasis{\sphinxupquote{ | }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} The maximum depth of the QuadTree. If set, this can override the
capacity for cells at the maximum depth.

\end{itemize}

\end{description}\end{quote}
\index{divide() (geotrees.octtree.OctTree method)@\spxentry{divide()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.divide}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{divide}}}
{}
{}
\pysigstopsignatures
\sphinxAtStartPar
Divide the QuadTree

\end{fulllineitems}

\index{insert() (geotrees.octtree.OctTree method)@\spxentry{insert()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.insert}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{insert}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Insert a point into the OctTree.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} (\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimSpaceTimeeRecord}}) \textendash{} The point to insert

\sphinxlineitem{Returns}
\sphinxAtStartPar
True if the point was inserted into the OctTree

\sphinxlineitem{Return type}
\sphinxAtStartPar
bool

\end{description}\end{quote}

\end{fulllineitems}

\index{insert\_into\_branch() (geotrees.octtree.OctTree method)@\spxentry{insert\_into\_branch()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.insert_into_branch}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{insert\_into\_branch}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Insert a point into a branch OctTree.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRecord}}}}}) \textendash{} The point to insert

\sphinxlineitem{Returns}
\sphinxAtStartPar
True if the point was inserted into a branch OctTree

\sphinxlineitem{Return type}
\sphinxAtStartPar
bool

\end{description}\end{quote}

\end{fulllineitems}

\index{len() (geotrees.octtree.OctTree method)@\spxentry{len()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.len}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{len}}}
{\sphinxparam{\DUrole{n}{current\_len}\DUrole{o}{=}\DUrole{default_value}{0}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get the number of points in the OctTree
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{int}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{nearby\_points() (geotrees.octtree.OctTree method)@\spxentry{nearby\_points()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.nearby_points}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{nearby\_points}}}
{\sphinxparam{\DUrole{n}{point}}\sphinxparamcomma \sphinxparam{\DUrole{n}{dist}}\sphinxparamcomma \sphinxparam{\DUrole{n}{t\_dist}}\sphinxparamcomma \sphinxparam{\DUrole{n}{points}\DUrole{o}{=}\DUrole{default_value}{None}}\sphinxparamcomma \sphinxparam{\DUrole{n}{exclude\_self}\DUrole{o}{=}\DUrole{default_value}{False}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get all SpaceTimeRecords contained in the OctTree that are nearby
another query SpaceTimeRecord.

\sphinxAtStartPar
Query the OctTree to find all SpaceTimeRecords within the OctTree that
are nearby to the query SpaceTimeRecord. This search should be faster
than searching through all records, since only OctTree branch whose
boundaries are close to the query SpaceTimeRecord are evaluated.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRecord}}}}}) \textendash{} The query point.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{dist}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} The distance for comparison. Note that Haversine distance is used
as the distance metric as the query SpaceTimeRecord and OctTree are
assumed to lie on the surface of Earth.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{t\_dist}} (\sphinxstyleliteralemphasis{\sphinxupquote{datetime.timedelta}}) \textendash{} Max time gap between SpaceTimeRecords within the OctTree and the
query SpaceTimeRecord. Can be numeric if the OctTree boundaries,
SpaceTimeRecords, and query SpaceTimeRecord have numeric datetime
values and ranges.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{points}} (\sphinxstyleliteralemphasis{\sphinxupquote{List}}\sphinxstyleliteralemphasis{\sphinxupquote{{[}}}{\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRecord}}}}}\sphinxstyleliteralemphasis{\sphinxupquote{{]} }}\sphinxstyleliteralemphasis{\sphinxupquote{| }}\sphinxstyleliteralemphasis{\sphinxupquote{None}}) \textendash{} List of SpaceTimeRecords already found. Most use cases will be to
not set this value, since it’s main use is for passing onto the
branch OctTrees.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{exclude\_self}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Optionally exclude the query point from the results if the query
point is in the OctTree

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
A list of SpaceTimeRecords whose distance to the
query SpaceTimeRecord is \textless{}= dist, and the datetimes of the
SpaceTimeRecords fall within the datetime range of the query
SpaceTimeRecord.

\sphinxlineitem{Return type}
\sphinxAtStartPar
list{[}{\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{SpaceTimeRecord}}}{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{query() (geotrees.octtree.OctTree method)@\spxentry{query()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.query}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{query}}}
{\sphinxparam{\DUrole{n}{rect}}\sphinxparamcomma \sphinxparam{\DUrole{n}{points}\DUrole{o}{=}\DUrole{default_value}{None}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get SpaceTimeRecords contained within the OctTree that fall in a
SpaceTimeRectangle
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{rect}} ({\hyperref[\detokenize{shape:geotrees.shape.SpaceTimeRectangle}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRectangle}}}}})

\sphinxlineitem{Returns}
\sphinxAtStartPar
The SpaceTimeRecord values contained within the OctTree that fall
within the bounds of rect.

\sphinxlineitem{Return type}
\sphinxAtStartPar
List{[}{\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{SpaceTimeRecord}}}{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{query\_ellipse() (geotrees.octtree.OctTree method)@\spxentry{query\_ellipse()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.query_ellipse}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{query\_ellipse}}}
{\sphinxparam{\DUrole{n}{ellipse}}\sphinxparamcomma \sphinxparam{\DUrole{n}{points}\DUrole{o}{=}\DUrole{default_value}{None}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get SpaceTimeRecords contained within the OctTree that fall in a
SpaceTimeEllipse
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{ellipse}} ({\hyperref[\detokenize{shape:geotrees.shape.SpaceTimeEllipse}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeEllipse}}}}})

\sphinxlineitem{Returns}
\sphinxAtStartPar
The SpaceTimeRecord values contained within the OctTree that fall
within the bounds of ellipse.

\sphinxlineitem{Return type}
\sphinxAtStartPar
List{[}{\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{SpaceTimeRecord}}}{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{redistribute\_to\_branches() (geotrees.octtree.OctTree method)@\spxentry{redistribute\_to\_branches()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.redistribute_to_branches}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{redistribute\_to\_branches}}}
{}
{}
\pysigstopsignatures
\sphinxAtStartPar
Redistribute all points to branches
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{None}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{remove() (geotrees.octtree.OctTree method)@\spxentry{remove()}\spxextra{geotrees.octtree.OctTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{octtree:geotrees.octtree.OctTree.remove}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{remove}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Remove a SpaceTimeRecord from the OctTree if it is in the OctTree.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{point}} ({\hyperref[\detokenize{record:geotrees.record.SpaceTimeRecord}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{SpaceTimeRecord}}}}}) \textendash{} The point to remove

\sphinxlineitem{Returns}
\sphinxAtStartPar
True if the point is removed

\sphinxlineitem{Return type}
\sphinxAtStartPar
bool

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}


\sphinxstepscope


\chapter{K\sphinxhyphen{}D\sphinxhyphen{}Tree}
\label{\detokenize{kdtree:k-d-tree}}\label{\detokenize{kdtree::doc}}
\sphinxAtStartPar
A K\sphinxhyphen{}D\sphinxhyphen{}Tree is a data structure that operates in a similar way to bisection or a binary tree, and can be used to find the
nearest neighbour. For \(k\)\sphinxhyphen{}dimensional data (i.e. the data has \(k\) features), a binary tree is constructed
by bisecting the data along each of the \(k\) dimensions in sequence. The first layer bisects the data along the
first dimension, the second layer bisects each of the previous bisection results along the 2nd dimension (the data is
now partitioned into 4), and so on. The pattern repeats after the \(k\)\sphinxhyphen{}th layer, until a single point of data
remains in each leaf node. A K\sphinxhyphen{}D\sphinxhyphen{}Tree that bisects data and results in each leaf node containing a single value is
called referred to as a balanced K\sphinxhyphen{}T\sphinxhyphen{}Tree.

\sphinxAtStartPar
To find the data point that is closest to a point in the tree, one descends the tree comparing the query point to the
partition value in each dimension. The final leaf node should be the closest point, however there may be a point closer
if the query point is close to a previous partition value, so some back tracking is performed to either confirm, or
update, the closest point.

\sphinxAtStartPar
A K\sphinxhyphen{}D\sphinxhyphen{}Tree can typically find the nearest neighbour in \(O(\log(n))\) time complexity, and the data structure has
\(O(n)\) space\sphinxhyphen{}complexity.

\sphinxAtStartPar
Most implementations of K\sphinxhyphen{}D\sphinxhyphen{}Tree assume that the coordinates use a cartesian geometry and therefore use a simple
Euclidean distance to identify the nearest neighbour. The implementation in \sphinxcode{\sphinxupquote{geotrees.kdtree}} assumes a
spherical geometry on the surface of the Earth and uses the Haversine distance to identify neighbours. The
implementation has been designed to account for longitude wrapping at \sphinxhyphen{}180, 180 degrees. The
\sphinxcode{\sphinxupquote{geotrees.kdtree.KDTree}} class is a 2\sphinxhyphen{}D\sphinxhyphen{}Tree, the dimensions are longitude and latitude. The object is
initialised with data in the form of a list of \sphinxcode{\sphinxupquote{geotrees.quadtree.Record}} objects. A maximum depth value
(\sphinxcode{\sphinxupquote{max\_depth}}) can be provided, if this is set then the partitioning will stop after \sphinxcode{\sphinxupquote{max\_depth}} partitionings,
the leaf nodes may contain more than one \sphinxcode{\sphinxupquote{Record}}.


\section{Example}
\label{\detokenize{kdtree:example}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{geotrees}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{KDTree}\PYG{p}{,} \PYG{n}{Record}
\PYG{k+kn}{from}\PYG{+w}{ }\PYG{n+nn}{random}\PYG{+w}{ }\PYG{k+kn}{import} \PYG{n}{choice}

\PYG{n}{lon\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,} \PYG{l+m+mi}{180}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{lat\PYGZus{}range} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n+nb}{range}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{90}\PYG{p}{,} \PYG{l+m+mi}{90}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{N\PYGZus{}samples} \PYG{o}{=} \PYG{l+m+mi}{1000}

\PYG{n}{records}\PYG{p}{:} \PYG{n+nb}{list}\PYG{p}{[}\PYG{n}{Record}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{n}{Record}\PYG{p}{(}\PYG{n}{choice}\PYG{p}{(}\PYG{n}{lon\PYGZus{}range}\PYG{p}{)}\PYG{p}{,} \PYG{n}{choice}\PYG{p}{(}\PYG{n}{lat\PYGZus{}range}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{\PYGZus{}} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N\PYGZus{}samples}\PYG{p}{)}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{} Construct Tree}
\PYG{n}{kdtree} \PYG{o}{=} \PYG{n}{KDTree}\PYG{p}{(}\PYG{n}{records}\PYG{p}{)}

\PYG{n}{test\PYGZus{}value}\PYG{p}{:} \PYG{n}{Record} \PYG{o}{=} \PYG{n}{Record}\PYG{p}{(}\PYG{n}{lon}\PYG{o}{=}\PYG{l+m+mf}{47.6}\PYG{p}{,} \PYG{n}{lat}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{31.1}\PYG{p}{)}
\PYG{n}{neighbours}\PYG{p}{,} \PYG{n}{dist} \PYG{o}{=} \PYG{n}{kdtree}\PYG{o}{.}\PYG{n}{query}\PYG{p}{(}\PYG{n}{test\PYGZus{}value}\PYG{p}{)}
\end{sphinxVerbatim}


\section{Documentation}
\label{\detokenize{kdtree:documentation}}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Insertion and deletion operations may cause the \sphinxcode{\sphinxupquote{KDTree}} to become un\sphinxhyphen{}balanced.
\end{sphinxadmonition}


\subsection{Inserting Records}
\label{\detokenize{kdtree:inserting-records}}
\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{Record}} can be inserted in to a \sphinxcode{\sphinxupquote{KDTree}} with the \sphinxcode{\sphinxupquote{KDTree.insert}} method. The method will return \sphinxcode{\sphinxupquote{True}} if
the \sphinxcode{\sphinxupquote{Record}} was inserted into the \sphinxcode{\sphinxupquote{KDTree}}, \sphinxcode{\sphinxupquote{False}} otherwise. A \sphinxcode{\sphinxupquote{Record}} will not be added if it is already
contained within the \sphinxcode{\sphinxupquote{KDTree}}, to add the \sphinxcode{\sphinxupquote{Record}} anyway use the \sphinxcode{\sphinxupquote{KDTree.\_insert}} method.


\subsection{Removing Records}
\label{\detokenize{kdtree:removing-records}}
\sphinxAtStartPar
A \sphinxcode{\sphinxupquote{Record}} can be removed from a \sphinxcode{\sphinxupquote{KDTree}} with the \sphinxcode{\sphinxupquote{KDTree.delete}} method. The method will return \sphinxcode{\sphinxupquote{True}} if the
\sphinxcode{\sphinxupquote{Record}} was successfully removed, \sphinxcode{\sphinxupquote{False}} otherwise (for example if the \sphinxcode{\sphinxupquote{Record}} is not contained within the
\sphinxcode{\sphinxupquote{KDTree}}).


\subsection{Querying}
\label{\detokenize{kdtree:querying}}
\sphinxAtStartPar
The nearest neighbour \sphinxcode{\sphinxupquote{Record}} contained within a \sphinxcode{\sphinxupquote{KDTree}} to a query \sphinxcode{\sphinxupquote{Record}} can be found with the
\sphinxcode{\sphinxupquote{KDTree.query}} method. This will return a tuple containing the list of \sphinxcode{\sphinxupquote{Record}} objects from the \sphinxcode{\sphinxupquote{KDTree}} with
minimum distance to the query \sphinxcode{\sphinxupquote{Record}}, and the minimum distance.


\section{kdtree Module}
\label{\detokenize{kdtree:module-geotrees.kdtree}}\label{\detokenize{kdtree:kdtree-module}}\index{module@\spxentry{module}!geotrees.kdtree@\spxentry{geotrees.kdtree}}\index{geotrees.kdtree@\spxentry{geotrees.kdtree}!module@\spxentry{module}}
\sphinxAtStartPar
An implementation of KDTree using Haversine Distance for GeoSpatial analysis.
Useful tool for quickly searching for nearest neighbours. The implementation is
a K=2 or 2DTree as only 2 dimensions (longitude and latitude) are used.

\sphinxAtStartPar
Haversine distances are used for comparisons, so that the spherical geometry
of the earth is accounted for.
\index{KDTree (class in geotrees.kdtree)@\spxentry{KDTree}\spxextra{class in geotrees.kdtree}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{kdtree:geotrees.kdtree.KDTree}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.kdtree.}}\sphinxbfcode{\sphinxupquote{KDTree}}}
{\sphinxparam{\DUrole{n}{points}}\sphinxparamcomma \sphinxparam{\DUrole{n}{depth}\DUrole{o}{=}\DUrole{default_value}{0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{max\_depth}\DUrole{o}{=}\DUrole{default_value}{20}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A Haverine distance implementation of a balanced KDTree.

\sphinxAtStartPar
This implementation is a \_balanced\_ KDTree, each leaf node should have the
same number of points (or differ by 1 depending on the number of points
the KDTree is initialised with).

\sphinxAtStartPar
The KDTree partitions in each of the lon and lat dimensions alternatively
in sequence by splitting at the median of the dimension of the points
assigned to the branch.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{points}} (\sphinxstyleliteralemphasis{\sphinxupquote{list}}\sphinxstyleliteralemphasis{\sphinxupquote{{[}}}{\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{Record}}}}}\sphinxstyleliteralemphasis{\sphinxupquote{{]}}}) \textendash{} A list of geotrees.Record instances.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{depth}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \textendash{} The current depth of the KDTree, you should set this to 0, it is used
internally.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{max\_depth}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \textendash{} The maximum depth of the KDTree. The leaf nodes will have depth no
larger than this value. Leaf nodes will not be created if there is
only 1 point in the branch.

\end{itemize}

\end{description}\end{quote}
\index{delete() (geotrees.kdtree.KDTree method)@\spxentry{delete()}\spxextra{geotrees.kdtree.KDTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{kdtree:geotrees.kdtree.KDTree.delete}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{delete}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Delete a Record from the KDTree. May unbalance the KDTree
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{insert() (geotrees.kdtree.KDTree method)@\spxentry{insert()}\spxextra{geotrees.kdtree.KDTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{kdtree:geotrees.kdtree.KDTree.insert}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{insert}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Insert a Record into the KDTree. May unbalance the KDTree.

\sphinxAtStartPar
The point will not be inserted if it is already in the KDTree.
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{bool}}}

\end{description}\end{quote}

\end{fulllineitems}

\index{query() (geotrees.kdtree.KDTree method)@\spxentry{query()}\spxextra{geotrees.kdtree.KDTree method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{kdtree:geotrees.kdtree.KDTree.query}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{query}}}
{\sphinxparam{\DUrole{n}{point}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Find the nearest Record within the KDTree to a query Record
\begin{quote}\begin{description}
\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{Tuple}}{[}\sphinxcode{\sphinxupquote{List}}{[}{\hyperref[\detokenize{record:geotrees.record.Record}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{Record}}}}}{]}, \sphinxcode{\sphinxupquote{float}}{]}}

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}


\sphinxstepscope


\chapter{Additional Modules}
\label{\detokenize{users_guide:module-geotrees.great_circle}}\label{\detokenize{users_guide:additional-modules}}\label{\detokenize{users_guide::doc}}\index{module@\spxentry{module}!geotrees.great\_circle@\spxentry{geotrees.great\_circle}}\index{geotrees.great\_circle@\spxentry{geotrees.great\_circle}!module@\spxentry{module}}

\section{GreatCircle}
\label{\detokenize{users_guide:greatcircle}}
\sphinxAtStartPar
Constructors and methods for interacting with GreatCircle objects, including
comparisons between GreatCircle objects.
\index{GreatCircle (class in geotrees.great\_circle)@\spxentry{GreatCircle}\spxextra{class in geotrees.great\_circle}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.great_circle.GreatCircle}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{class}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.great\_circle.}}\sphinxbfcode{\sphinxupquote{GreatCircle}}}
{\sphinxparam{\DUrole{n}{lon0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lon1}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat1}}\sphinxparamcomma \sphinxparam{\DUrole{n}{radius}\DUrole{o}{=}\DUrole{default_value}{6371}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
A GreatCircle object for a pair of positions.

\sphinxAtStartPar
Construct a great circle path between a pair of positions.

\sphinxAtStartPar
\sphinxurl{https://www.boeing-727.com/Data/fly\%20odds/distance.html}
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of start position.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of start position.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of end position.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of end position.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{R}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Radius of the sphere. Default is Earth radius in km (6371.0).

\end{itemize}

\end{description}\end{quote}
\index{dist\_from\_point() (geotrees.great\_circle.GreatCircle method)@\spxentry{dist\_from\_point()}\spxextra{geotrees.great\_circle.GreatCircle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.great_circle.GreatCircle.dist_from_point}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{dist\_from\_point}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute distance from the GreatCircle to a point on the sphere.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of the position to test.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of the position to test.

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
Minimum distance between point and the GreatCircle arc.

\sphinxlineitem{Return type}
\sphinxAtStartPar
float

\end{description}\end{quote}

\end{fulllineitems}

\index{intersection() (geotrees.great\_circle.GreatCircle method)@\spxentry{intersection()}\spxextra{geotrees.great\_circle.GreatCircle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.great_circle.GreatCircle.intersection}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{intersection}}}
{\sphinxparam{\DUrole{n}{other}}\sphinxparamcomma \sphinxparam{\DUrole{n}{epsilon}\DUrole{o}{=}\DUrole{default_value}{0.01}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Determine intersection position with another GreatCircle.

\sphinxAtStartPar
Determine the location at which the GreatCircle intersects another
GreatCircle arc. (To within some epsilon threshold).

\sphinxAtStartPar
Returns \sphinxtitleref{None} if there is no solution \sphinxhyphen{} either because there is no
intersection point, or the planes generated from the arc and centre of
the sphere are identical.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{other}} ({\hyperref[\detokenize{users_guide:geotrees.great_circle.GreatCircle}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{GreatCircle}}}}}) \textendash{} Intersecting GreatCircle object

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{epsilon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Threshold for intersection

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
Position of intersection

\sphinxlineitem{Return type}
\sphinxAtStartPar
(float, float) | None

\end{description}\end{quote}

\end{fulllineitems}

\index{intersection\_angle() (geotrees.great\_circle.GreatCircle method)@\spxentry{intersection\_angle()}\spxextra{geotrees.great\_circle.GreatCircle method}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.great_circle.GreatCircle.intersection_angle}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxbfcode{\sphinxupquote{intersection\_angle}}}
{\sphinxparam{\DUrole{n}{other}}\sphinxparamcomma \sphinxparam{\DUrole{n}{epsilon}\DUrole{o}{=}\DUrole{default_value}{0.01}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get angle of intersection with another GreatCircle.

\sphinxAtStartPar
Get the angle of intersection with another GreatCircle arc. Returns
None if there is no intersection.

\sphinxAtStartPar
The intersection angle is computed using the normals of the planes
formed by the two intersecting great circle objects.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{other}} ({\hyperref[\detokenize{users_guide:geotrees.great_circle.GreatCircle}]{\sphinxcrossref{\sphinxstyleliteralemphasis{\sphinxupquote{GreatCircle}}}}}) \textendash{} Intersecting GreatCircle object

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{epsilon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Threshold for intersection

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
Intersection angle in degrees

\sphinxlineitem{Return type}
\sphinxAtStartPar
float | None

\end{description}\end{quote}

\end{fulllineitems}


\end{fulllineitems}

\index{cartesian\_to\_lonlat() (in module geotrees.great\_circle)@\spxentry{cartesian\_to\_lonlat()}\spxextra{in module geotrees.great\_circle}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.great_circle.cartesian_to_lonlat}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.great\_circle.}}\sphinxbfcode{\sphinxupquote{cartesian\_to\_lonlat}}}
{\sphinxparam{\DUrole{n}{x}}\sphinxparamcomma \sphinxparam{\DUrole{n}{y}}\sphinxparamcomma \sphinxparam{\DUrole{n}{z}}\sphinxparamcomma \sphinxparam{\DUrole{n}{to\_radians}\DUrole{o}{=}\DUrole{default_value}{False}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Get lon, and lat from cartesian coordinates.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{x}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} x coordinate

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{y}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} y coordinate

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{z}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} z coordinate

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{to\_radians}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Return angles in radians. Otherwise return values in degrees.

\end{itemize}

\sphinxlineitem{Return type}
\sphinxAtStartPar
\DUrole{sphinx_autodoc_typehints-type}{\sphinxcode{\sphinxupquote{Tuple}}{[}\sphinxcode{\sphinxupquote{float}}, \sphinxcode{\sphinxupquote{float}}{]}}

\sphinxlineitem{Returns}
\sphinxAtStartPar
\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleemphasis{(float, float)}

\item {}
\sphinxAtStartPar
\sphinxstyleemphasis{lon, lat}

\end{itemize}


\end{description}\end{quote}

\end{fulllineitems}

\index{polar\_to\_cartesian() (in module geotrees.great\_circle)@\spxentry{polar\_to\_cartesian()}\spxextra{in module geotrees.great\_circle}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.great_circle.polar_to_cartesian}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.great\_circle.}}\sphinxbfcode{\sphinxupquote{polar\_to\_cartesian}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}\sphinxparamcomma \sphinxparam{\DUrole{n}{radius}\DUrole{o}{=}\DUrole{default_value}{6371}}\sphinxparamcomma \sphinxparam{\DUrole{n}{to\_radians}\DUrole{o}{=}\DUrole{default_value}{True}}\sphinxparamcomma \sphinxparam{\DUrole{n}{normalised}\DUrole{o}{=}\DUrole{default_value}{True}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Convert from polars coordinates to cartesian.

\sphinxAtStartPar
Get cartesian coordinates from spherical polar coordinates. Default
behaviour assumes lon and lat, so converts to radians. Set
\sphinxtitleref{to\_radians=False} if the coordinates are already in radians.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{R}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Radius of sphere.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{to\_radians}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Convert lon and lat to radians.

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{normalised}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \textendash{} Return normalised vector (ignore R value).

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
x, y, z cartesian coordinates.

\sphinxlineitem{Return type}
\sphinxAtStartPar
(float, float, float)

\end{description}\end{quote}

\end{fulllineitems}

\index{module@\spxentry{module}!geotrees.distance\_metrics@\spxentry{geotrees.distance\_metrics}}\index{geotrees.distance\_metrics@\spxentry{geotrees.distance\_metrics}!module@\spxentry{module}}

\section{Distance Metrics}
\label{\detokenize{users_guide:distance-metrics}}\label{\detokenize{users_guide:module-geotrees.distance_metrics}}
\sphinxAtStartPar
Functions for computing navigational information. Can be used to add
navigational information to DataFrames.
\index{bearing() (in module geotrees.distance\_metrics)@\spxentry{bearing()}\spxextra{in module geotrees.distance\_metrics}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.distance_metrics.bearing}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.distance\_metrics.}}\sphinxbfcode{\sphinxupquote{bearing}}}
{\sphinxparam{\DUrole{n}{lon0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lon1}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat1}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute the bearing of a track from (lon0, lat0) to (lon1, lat1).

\sphinxAtStartPar
Duplicated from geo\sphinxhyphen{}py
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}\sphinxstyleliteralemphasis{\sphinxupquote{,}}) \textendash{} Longitude of start point

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}\sphinxstyleliteralemphasis{\sphinxupquote{,}}) \textendash{} Latitude of start point

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}\sphinxstyleliteralemphasis{\sphinxupquote{,}}) \textendash{} Longitude of target point

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}\sphinxstyleliteralemphasis{\sphinxupquote{,}}) \textendash{} Latitude of target point

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
\sphinxstylestrong{bearing} \textendash{} The bearing from point (lon0, lat0) to point (lon1, lat1) in degrees.

\sphinxlineitem{Return type}
\sphinxAtStartPar
float

\end{description}\end{quote}

\end{fulllineitems}

\index{destination() (in module geotrees.distance\_metrics)@\spxentry{destination()}\spxextra{in module geotrees.distance\_metrics}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.distance_metrics.destination}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.distance\_metrics.}}\sphinxbfcode{\sphinxupquote{destination}}}
{\sphinxparam{\DUrole{n}{lon}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat}}\sphinxparamcomma \sphinxparam{\DUrole{n}{bearing}}\sphinxparamcomma \sphinxparam{\DUrole{n}{distance}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute destination of a great circle path.

\sphinxAtStartPar
Compute the destination of a track started from ‘lon’, ‘lat’, with
‘bearing’. Distance is in units of km.

\sphinxAtStartPar
Duplicated from geo\sphinxhyphen{}py
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of initial position

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of initial position

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{bearing}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Direction of track

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{distance}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Distance to travel

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
\sphinxstylestrong{destination} \textendash{} Longitude and Latitude of final position

\sphinxlineitem{Return type}
\sphinxAtStartPar
tuple{[}float, float{]}

\end{description}\end{quote}

\end{fulllineitems}

\index{gcd\_slc() (in module geotrees.distance\_metrics)@\spxentry{gcd\_slc()}\spxextra{in module geotrees.distance\_metrics}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.distance_metrics.gcd_slc}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.distance\_metrics.}}\sphinxbfcode{\sphinxupquote{gcd\_slc}}}
{\sphinxparam{\DUrole{n}{lon0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lon1}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat1}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute great circle distance on earth surface between two locations.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of position 0

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of position 0

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of position 1

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of position 1

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
\sphinxstylestrong{dist} \textendash{} Great circle distance between position 0 and position 1.

\sphinxlineitem{Return type}
\sphinxAtStartPar
float

\end{description}\end{quote}

\end{fulllineitems}

\index{haversine() (in module geotrees.distance\_metrics)@\spxentry{haversine()}\spxextra{in module geotrees.distance\_metrics}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.distance_metrics.haversine}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.distance\_metrics.}}\sphinxbfcode{\sphinxupquote{haversine}}}
{\sphinxparam{\DUrole{n}{lon0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lon1}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat1}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute Haversine distance between two points.
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of position 0

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of position 0

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of position 1

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of position 1

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
\sphinxstylestrong{dist} \textendash{} Haversine distance between position 0 and position 1.

\sphinxlineitem{Return type}
\sphinxAtStartPar
float

\end{description}\end{quote}

\end{fulllineitems}

\index{midpoint() (in module geotrees.distance\_metrics)@\spxentry{midpoint()}\spxextra{in module geotrees.distance\_metrics}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.distance_metrics.midpoint}}
\pysigstartsignatures
\pysiglinewithargsret
{\sphinxcode{\sphinxupquote{geotrees.distance\_metrics.}}\sphinxbfcode{\sphinxupquote{midpoint}}}
{\sphinxparam{\DUrole{n}{lon0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat0}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lon1}}\sphinxparamcomma \sphinxparam{\DUrole{n}{lat1}}}
{}
\pysigstopsignatures
\sphinxAtStartPar
Compute the midpoint of a great circle track
\begin{quote}\begin{description}
\sphinxlineitem{Parameters}\begin{itemize}
\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of position 0

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat0}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of position 0

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lon1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Longitude of position 1

\item {}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{lat1}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \textendash{} Latitude of position 1

\end{itemize}

\sphinxlineitem{Returns}
\sphinxAtStartPar
Positions of midpoint between position 0 and position 1

\sphinxlineitem{Return type}
\sphinxAtStartPar
lon, lat

\end{description}\end{quote}

\end{fulllineitems}

\index{module@\spxentry{module}!geotrees.utils@\spxentry{geotrees.utils}}\index{geotrees.utils@\spxentry{geotrees.utils}!module@\spxentry{module}}

\section{Utils}
\label{\detokenize{users_guide:utils}}\label{\detokenize{users_guide:module-geotrees.utils}}
\sphinxAtStartPar
Utility functions. Including Error classes and Warnings.
\index{DateWarning@\spxentry{DateWarning}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.utils.DateWarning}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{exception}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.utils.}}\sphinxbfcode{\sphinxupquote{DateWarning}}}
\pysigstopsignatures
\sphinxAtStartPar
Warning for Datetime Value

\end{fulllineitems}

\index{LatitudeError@\spxentry{LatitudeError}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{users_guide:geotrees.utils.LatitudeError}}
\pysigstartsignatures
\pysigline
{\sphinxbfcode{\sphinxupquote{\DUrole{k}{exception}\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{geotrees.utils.}}\sphinxbfcode{\sphinxupquote{LatitudeError}}}
\pysigstopsignatures
\sphinxAtStartPar
Error for invalid Latitude Value

\end{fulllineitems}



\renewcommand{\indexname}{Python Module Index}
\begin{sphinxtheindex}
\let\bigletter\sphinxstyleindexlettergroup
\bigletter{g}
\item\relax\sphinxstyleindexentry{geotrees.distance\_metrics}\sphinxstyleindexpageref{users_guide:\detokenize{module-geotrees.distance_metrics}}
\item\relax\sphinxstyleindexentry{geotrees.great\_circle}\sphinxstyleindexpageref{users_guide:\detokenize{module-geotrees.great_circle}}
\item\relax\sphinxstyleindexentry{geotrees.kdtree}\sphinxstyleindexpageref{kdtree:\detokenize{module-geotrees.kdtree}}
\item\relax\sphinxstyleindexentry{geotrees.neighbours}\sphinxstyleindexpageref{bisection:\detokenize{module-geotrees.neighbours}}
\item\relax\sphinxstyleindexentry{geotrees.octtree}\sphinxstyleindexpageref{octtree:\detokenize{module-geotrees.octtree}}
\item\relax\sphinxstyleindexentry{geotrees.quadtree}\sphinxstyleindexpageref{quadtree:\detokenize{module-geotrees.quadtree}}
\item\relax\sphinxstyleindexentry{geotrees.record}\sphinxstyleindexpageref{record:\detokenize{module-geotrees.record}}
\item\relax\sphinxstyleindexentry{geotrees.shape}\sphinxstyleindexpageref{shape:\detokenize{module-geotrees.shape}}
\item\relax\sphinxstyleindexentry{geotrees.utils}\sphinxstyleindexpageref{users_guide:\detokenize{module-geotrees.utils}}
\end{sphinxtheindex}

\renewcommand{\indexname}{Index}
\printindex
\end{document}
